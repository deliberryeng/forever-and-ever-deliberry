function clickAndDisable(link){link.onclick=function(event){event.preventDefault()}}function selectCategory(event){var id=event.data.id,dataAttr=$(this).parent().data("category");$(id+" .categories-navigation").addClass("has-selected-cat"),$(this).parent().addClass("selected-cat"),$(id+' [data-drop-category="'+dataAttr+'"]').addClass("selected-category"),$(".container--with-nav").css({color:"#ffffff"}),goToStore(id,dataAttr)||itemsList(id,dataAttr)}function resetFilter(){$("#fixed-store-list .categories-navigation").removeClass("has-selected-cat"),$("li","#fixed-store-list .main-cat-navigation").removeClass("selected-cat"),$("li","#fixed-store-list .dropdown-cat-navigation").removeClass("selected-category"),$("#fixed-store-list .no-found-disclaimer").hide(),$('#fixed-store-list [data-drop-category="todas"]').addClass("selected-category"),$("#fixed-store-list .dropdown-cat-navigation").removeClass("in"),itemsList("#fixed-store-list","todas")}function selectFromDropdown(event){var id=event.data.id,dataAttr=$(this).data("drop-category");$(id+" .categories-navigation").addClass("has-selected-cat"),goToStore(id,dataAttr)||(itemsList(id,dataAttr),$("li",id+" .main-cat-navigation").removeClass("selected-cat"),$(id+' [data-category="'+dataAttr+'"]').addClass("selected-cat"),$("li",id+" .dropdown-cat-navigation").removeClass("selected-category"),$(this).addClass("selected-category"),$(id+" .dropdown-cat-navigation").removeClass("in"))}function itemsList(id,selector){var selectedClass="."+selector;$(id+" .no-found-disclaimer").hide(),$(id+" .store-item-wrapper").hide(),0<$(id+" "+selectedClass).length?$(id+" "+selectedClass).fadeIn():$(id+" .no-found-disclaimer").show(),$(id+" .categories-select").fadeOut(),$(id+" .categories-filter-section").show()}function goToStore(id,dataAttr){return 1===$(id+" ."+dataAttr).children().length&&($(id+" ."+dataAttr).children().first()[0].click(),!0)}$(function(){var $mainContent=$("#js-content"),$btnShowFilters=$(".js-show-filters"),$menuTrigger=$(".js-menu-trigger"),$menuOffcanvas=$(".menu-offcanvas"),$closeOffcanvas=$(".js-hide-menu-burger"),normalize=function(){for(var from="ÃÀÁÄÂÈÉËÊÌÍÏÎÒÓÖÔÙÚÜÛãàáäâèéëêìíïîòóöôùúüûÇç",mapping={},i=0,j=from.length;i<j;i++)mapping[from.charAt(i)]="AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuucc".charAt(i);return function(str){for(var ret=[],i=0,j=str.length;i<j;i++){var c=str.charAt(i);mapping.hasOwnProperty(str.charAt(i))?ret.push(mapping[c]):ret.push(c)}return ret.join("")}}();isMobile.any()&&$(".btn-group-justified").css("visibility","visible"),$(".js-user-nav").on("click",function(){$("#cart-sidebar").hasClass("hidden")||($("#cart-sidebar").addClass("hidden"),$mainContent.toggleClass("js-cart-opened"))}),$menuTrigger.on("click",function(event){event.preventDefault(),$menuOffcanvas.addClass("open")}),$closeOffcanvas.on("click",function(event){event.preventDefault(),$menuOffcanvas.removeClass("open")}),"undefined"!=typeof g_url_search_tags&&$("#search_q").autocomplete({serviceUrl:g_url_search_tags,paramName:"q",minChars:3,width:360,formatResult:function(suggestion,currentValue){currentValue=normalize(currentValue);var pattern="("+currentValue.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+")";return suggestion.value.replace(new RegExp(pattern,"gi"),"<strong>$1</strong>").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/&lt;(\/?strong)&gt;/g,"<$1>")},autoSelectFirst:!1,onSelect:function(suggestions){$(".js-form-search").submit()}}),$(".js-trigger-filters").click(function(){$(".filters-placeholder").toggleClass("is-closed")}),$(".js-checkbox-filter").change(function(){var $checkbox=$(this);window.location.href=$checkbox.data("target")}),$btnShowFilters.on("click",function(){$(this).parent().prevAll(".js-filter-hidden").toggleClass("hidden"),$(this).text(function(i,text){return"Ver más"===text?"Ver menos":"Ver más"})}),$("#modalAlerts").on("shown.bs.modal",function(){$(".basky").addClass("open"),$(".alerTitle").addClass("open")}),$("#modalAlerts").on("hidden.bs.modal",function(){$(".basky").removeClass("open"),$(".alerTitle").removeClass("open")})}),$(function(){var clickTimeout,resizeTimer,pendingProduct=[],productsMod=[],$mainContent=$("#js-content"),$btnContinue=$("#btnContinue"),$xs=764,fixed=$("#cart-sidebar"),convertFastDeliveryCartToMarketPlaceProductId=null,convertFastDeliveryCartToMarketPlaceQuantityRemaining=null,convertFastDeliveryCartToMarketplace=document.getElementById("convertFastDeliveryCartToMarketplace"),confirmedProductsNotFoundConvertFastDeliveryCartToMarketplace=document.getElementById("confirmedProductsNotFoundConvertFastDeliveryCartToMarketplace"),currentCarts={data:null,get getData(){return this.data},set setData(carts){this.data=carts}},currentStore=document.querySelector(".js-current-store"),hasCurrentStoreFastDelivery=Boolean(currentStore.dataset.hasFastDelivey),isCurrentStoreOpen=Boolean(currentStore.dataset.isItOpen);function htmlEntities(str){return String(str).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function checkOffset(){var $cookiesMsg=$(".cookies-alert");$cookiesMsg.length?($btnContinue.offset().top+$btnContinue.height()>=$cookiesMsg.offset().top-20&&$btnContinue.removeClass("btn-continue--fixed").addClass("btn-continue--unfixed").css("margin-bottom","50px"),$(document).scrollTop()+window.innerHeight<$cookiesMsg.offset().top&&$btnContinue.removeClass("btn-continue--unfixed").addClass("btn-continue--fixed").css("margin-bottom","0px"),$(".js-cookies-alert").on("click",function(){$btnContinue.css("margin-bottom","0px")})):($btnContinue.offset().top+$btnContinue.height()>=$("footer").offset().top-10&&$btnContinue.removeClass("btn-continue--fixed").addClass("btn-continue--unfixed"),$(document).scrollTop()+window.innerHeight<$("footer").offset().top&&$btnContinue.removeClass("btn-continue--unfixed").addClass("btn-continue--fixed"))}function triggerCart(){"true"===Cookies.get("cartToggle")?(Cookies.set("cartToggle",!1,{path:"/",expires:7}),$btnContinue.length&&$btnContinue.removeClass("hidden")):Cookies.set("cartToggle",!0,{path:"/",expires:7}),$("#cart-sidebar").toggleClass("hidden"),$(window).width()>=$xs?($mainContent.toggleClass("js-cart-opened"),$btnContinue.length&&checkOffset()):$("body").toggleClass("no-scroll")}function isPostalCodeFlagCookieSetted(){return 0<=document.cookie.indexOf("postalCodeFlag=")}function showPostalCodeModal(){$("#modalPostalCode").modal()}function getProductObject(triggerEvent){return $(triggerEvent).closest("[data-product]").data("product")}function ajaxModifyCart(args){return $.ajax({url:args.ajaxUrl.replace("0000",args.productId),data:args.items?{"add-cart-quantity":args.items}:"",method:"POST",async:!0,context:document.body,beforeSend:function(){args.btn.addClass("disabled"),args.spinner.show()}})}function showCheckoutButtonAlert($cartAlert,$cartAlertMsg){$cartAlert.removeClass("hidden"),setTimeout(function(){$cartAlert.addClass("open"),$cartAlertMsg.addClass("open")},10),$(".cart-alert .close, .cart-alert").on("click",function(){$cartAlert.removeClass("open"),$cartAlertMsg.removeClass("open"),setTimeout(function(){$(".cart-alert").addClass("hidden"),triggerCart()},1e3)})}function addProductToCart(product,$modal,$thisBtn){var $loading=$(".merchant-cart-"+product.storeSlug).find(".js-product-loading-cart"),items=productsMod[product.id];ajaxModifyCart({ajaxUrl:g_url_add_product.replace("0000",product.id),productId:product.id,items:items,spinner:$loading,btn:$thisBtn}).done(function(data){if(productsMod[product.id]=0,$thisBtn.removeClass("disabled"),$loading.hide(),$(".js-add-product.disabled").removeClass("disabled"),!0===data.reload&&(window.location.href=data.path),!1!==data.success){if(void 0===data.exceeded||(function(exceeded,product,showMessage){if(document.querySelector("#itemProduct-"+product.id)){var $productItem=$("#itemProduct-"+product.id),productUnits=Number($productItem.find(".item-selection-units").html()),newProductUnits=productUnits-(exceeded.quantity-exceeded.added);$productItem.find(".item-selection-units").html(newProductUnits),$productItem.find(".item-qty span").html(newProductUnits)}showMessage&&(message=exceeded.message,$limitUnitsDOM=$('<div class="container-alert"><div class="alert alert-danger alert-dismissible animated fadeInDown" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>'+message+"</div></div>"),$(".wrap-all").append($limitUnitsDOM));var message,$limitUnitsDOM}(data.exceeded,product,1!=data.exceeded.fastDeliveryCartCanBeConvertedToMarketplace),!0===data.exceeded.fastDeliveryCartCanBeConvertedToMarketplace&&function(productId,quantityRemaining,productsNotFound,cause,nextDeliveryDate){convertFastDeliveryCartToMarketPlaceProductId=productId,convertFastDeliveryCartToMarketPlaceQuantityRemaining=quantityRemaining,0!=productsNotFound.length&&(!function(productsNotFound){for(var productsNotFoundItemsString="",i=0;i<productsNotFound.length;i++){var productNotFound=productsNotFound[i];productsNotFoundItemsString+='<div        class="wrapper" >            <div        class="wrapper-item-image" >            <img        src = "'+productNotFound.image+'"        alt = "'+productNotFound.name+'"            >            </div>        <div class="wrapper-item-name">            <div>'+productNotFound.name+'</div>            <span class="text-capitalize">'+productNotFound.manufacturerName+"</span>        </div>    </div>"}document.getElementById("productsNotFoundItemsId").innerHTML=productsNotFoundItemsString}(productsNotFound),convertFastDeliveryCartToMarketplace.onclick=fadeOutFadeInModalsConvertCart);0==productsNotFound.length&&(convertFastDeliveryCartToMarketplace.onclick=defaultFunctionConvertCart);"exceededFastDeliveryReference"===cause&&($("#modalConvertToMarketPlaceTextExceed").text("¡Tu cesta ha alcanzado el máximo número de productos para entregas en pocos minutos!"),$("#cancelFastDeliveryCartToMarketplaceSubText").text("Limitaré los productos de mi cesta"),$("#cancelFastDeliveryCartToMarketplaceNotFoundProductSubText").text("Recibiré mi pedido en minutos"));"exceededFastDeliveryWeight"===cause&&($("#modalConvertToMarketPlaceTextExceed").text("¡Tu cesta ha alcanzado el peso máximo para entregas en pocos minutos!"),$("#cancelFastDeliveryCartToMarketplaceSubText").text("Limitando el peso de mi cesta"),$("#cancelFastDeliveryCartToMarketplaceNotFoundProductSubText").text("Limitaré el peso y recibiré mi compra en minutos"));var modalConvertToMarketPlace=document.getElementById("modalConvertToMarketPlace"),modalDialogConvertToMarketPlace=document.getElementById("modalDialogConvertToMarketPlace");modalConvertToMarketPlace.classList.add("showModal"),modalDialogConvertToMarketPlace.classList.add("showModal"),$(".nextDeliveryDate").text("Próxima entrega "+nextDeliveryDate)}(product.id,data.exceeded.quantity-data.exceeded.added,data.exceeded.productsNotFoundInMarketplace,data.exceeded.cause,data.exceeded.nextDeliveryTime),0!==data.exceeded.added)){var todayDate,$oPopoverDest;blinkCart(),function(cart){var storeCartNotExist=0===document.getElementsByClassName("merchant-cart-"+cart.product.storeSlug).length,lineCartNotExist=null===document.querySelector("#itemCart-"+cart.product.id);if(storeCartNotExist){var minimumOrder=$(".js-current-store-min-order").data("minimum-order");if(void 0!==cart.nextDelivery)new Date,new Date(cart.nextDelivery.day);var cartDOM='<div class="merchant-cart-'+cart.product.storeSlug+'" data-minimum-order="'+minimumOrder+'" id="cart-'+cart.idCart+'"><div class="cart-header" role="button" data-toggle="collapse" href="#collapseCart-'+cart.idCart+'" aria-expanded="false" aria-controls="collapseCart-'+cart.idCart+'" data-cart=""><div class="remove-cart-ui"><div class="remove-icon-wrap js-remove-cart" data-id="'+cart.idEncrypted+'"><svg class="svg svg--white" ><use xlink:href="'+g_trash_icon_url+'"></use></svg></div></div><div class="cart-header-info"><img src="bundles/deliberrystoretemplate/img/markets/logo-'+cart.product.storeSlug+'-negativo.png"><svg class="svg svg--white"><use xlink:href="/bundles/deliberrystoretemplate/SVG/icons-sprite.svg#icon-angle-down"></use></svg><span class="db-spinner-small c-white js-product-loading-cart" style="display: none"></span><div class="pull-right"><div class="fz-xs d-ib mr-m"><span class="hidden-xxs">Pedido mínimo</span> <span class="visible-xs-inline-block">Mín.</span> <span class="js-store-min-order">'+minimumOrder+'</span> €</div><span class="label js-amount-merchant"></span></div></div></div><div id="cart-'+cart.idCart+'-delivery-fee-container"></div><div class="collapse in" id="collapseCart-'+cart.idCart+'"><table class="table table-cart mb-n"><tbody class="js-cart-'+cart.product.storeSlug+'"></tbody></table></div></div>';$(".cart-empty").addClass("hidden"),$(".js-cart-container").prepend(cartDOM)}var offsetMerchantHeader=$(".merchant-cart-"+cart.product.storeSlug).offset().top,offsetCartContainer=$(".js-cart-container").offset().top,$selectorWithCampaign=$(".js-cart-"+cart.product.storeSlug+" .js-cart-item-campaign"),$selectorWithoutCampaign=$(".js-cart-"+cart.product.storeSlug);if(lineCartNotExist){var productData,i;productData=cart.product.oferta?'{"id": '+cart.product.id+',"name": "'+cart.product.name+'","slug": "'+cart.product.slug+'", "price": "'+cart.product.price+'","image": "'+cart.product.images[0]+'","coupons": '+cart.offers+', "originalPrice": "'+cart.product.originalPrice+'", "limitUnit": '+cart.product.limitUnit+', "line": '+cart.lineId+', "storeSlug": "'+cart.product.storeSlug+'", "fishCutting": '+cart.product.fishCutting+', "meatCutting": '+cart.product.meatCutting+"}":'{"id": '+cart.product.id+',"name": "'+cart.product.name+'","slug": "'+cart.product.slug+'", "price": "'+cart.product.price+'","image": "'+cart.product.images[0]+'","coupons": '+cart.offers+', "limitUnit": '+cart.product.limitUnit+', "line": '+cart.lineId+', "storeSlug": "'+cart.product.storeSlug+'", "fishCutting": '+cart.product.fishCutting+', "meatCutting": '+cart.product.meatCutting+"}";var productDataObj=JSON.parse(productData),productCouponsLength=productDataObj.coupons.length;productData=htmlEntities(productData);var thumbImage=cart.product.images[0],item='<tr class="js-cart-item" data-product="'+productData+'" id="itemCart-'+cart.product.id+'"><td class="item-image"><img width="40" height="40" alt="'+cart.product.name+'" src="'+thumbImage+'"/></td><td class="item-name">'+cart.product.name+'<span class="item-manufacturer text-capitalize">'+cart.product.manufacturer+"</span>";for(i=0;i<productCouponsLength;i++)item+='<span class="item-offer strong center-block mt-s">'+productDataObj.coupons[i]+"</span>";productDataObj.originalPrice&&(item+='<span class="item-offer strong center-block mt-s">Oferta</span>'),item+='<a class="c-primary js-show-instructions mt-s" href="#">+ Añadir nota / Producto de sustitución</a><div class="js-intructions-box hide mt-s"><textarea class="js-save-instructions" data-line="'+cart.lineId+'" id="instructions-message-'+cart.lineId+'"></textarea></div><div class="js-note-content bg-warning"></div>',"undefined"!==productDataObj.fishCutting&&!0===productDataObj.fishCutting&&(item+=CuttingInstruction.fishCuttinInstructions(cart.lineId)),"undefined"!==productDataObj.meatCutting&&!0===productDataObj.meatCutting&&(item+=CuttingInstruction.meatCuttinInstructions(cart.lineId)),item+='</td><td class="item-units" ><div class="item-selection-units"></div><a href="#" class="js-add-product product-by-cart">+</a><a href="#" class="js-remove-product product-by-cart">-</a></td><td class="item-price"><span class="price"></span><s class="center-block js-original-price"></s></td><td class="item-edit"><a href="#" class="js-remove-line product-by-cart"><svg class="svg svg--white"><use xlink:href="/bundles/deliberrystoretemplate/SVG/icons-sprite.svg#icon-trash-o"></use></svg></a></td></tr>'}else var item=$("#itemCart-"+cart.product.id);$(".js-cart-container").animate({scrollTop:-(offsetCartContainer-offsetMerchantHeader)},500,function(){var $element;($element=$("#itemCart-"+cart.product.id)).removeClass("blink-cart-item-badge").width(),$element.addClass("blink-cart-item-badge")}),1<=$selectorWithCampaign.length?$selectorWithCampaign.after(item):$selectorWithoutCampaign.prepend(item)}({product:product,offers:data.coupons,lineId:data.cartLineId,idCart:data.cartId,nextDelivery:data.nextDeliveryTime,idEncrypted:data.cartEncryptedId}),refreshCart(data.masterCart),currentCarts.setData=data.masterCart.carts,20<=data.masterCart.quantity&&"true"===Cookies.get("timeLimitPopoverShow")&&(todayDate=new Date,$oPopoverDest=$(".js-control-cart"),todayDate.setTime(todayDate.getTime()+36e5),Cookies.set("timeLimitPopoverShow","false",{path:"/",expires:todayDate,domain:"."+document.domain}),$oPopoverDest.popover({title:"Tu shopper recomienda",html:"true",content:'La tienda está a punto de cerrar, para que nuestr@s shoppers puedan escoger tu compra con la máxima calidad te recomendamos solicites un máximo de 20 artículos y finalices tu pedido antes de las 20:35. Si deseas recibir el pedido mañana u otro día, sigue comprando sin problema. ¡Gracias! <a href="#" class="js-close-popover">Cerrar</a>',placement:"bottom",trigger:"focus",animation:!1,template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title fz-xs"></h3><div class="popover-content fz-xs"></div></div>'}),$oPopoverDest.popover("show"),$(".js-close-popover").one("click",function(){$oPopoverDest.popover("destroy")}));var $upsellingProduct=$("#cartItemCampaign-"+product.id);if(1===$upsellingProduct.length?$upsellingProduct.remove():function(carts){for(var cartsLength=carts.length,i=0;i<cartsLength;++i)if(void 0!==carts[i].cartSellingCampaign){var $cartId=$("#cart-"+carts[i].id);if(0===$cartId.find(".js-cart-item-campaign").length)for(var productReducedPrice,productCampaign=carts[i].cartSellingCampaign.products,productCampaignsLength=productCampaign.length,j=0;j<productCampaignsLength;++j)if("1"!==Cookies.get("storeCampaignCartProduct-"+productCampaign[j].id)){for(var productCampaignData,productPrice=(productCampaign[j].price/100).toFixed(2).replace(".",",")+" €",coupons="[",k=0;k<productCampaign[j].coupons.length;k++)coupons+='"'+productCampaign[j].coupons[k].name+'"',k!=productCampaign[j].coupons.length-1&&(coupons+=",");coupons+="]",productCampaignData=htmlEntities(productCampaignData=0<productCampaign[j].reducedPrice?(productReducedPrice=(productCampaign[j].reducedPrice/100).toFixed(2).replace(".",",")+" €",'{"id": '+productCampaign[j].id+',"name": "'+productCampaign[j].name+'","slug": "'+productCampaign[j].slug+'","manufacturer": "'+productCampaign[j].manufacturer.slug+'","oferta": true,"price": "'+productReducedPrice+'","image": "'+productCampaign[j].principalImage.midResRoute+'","images": ["'+productCampaign[j].principalImage.midResRoute+'"],"coupons": '+coupons+',"originalPrice": "'+productPrice+'","storeSlug": "'+productCampaign[j].store.slug+'","store": "'+productCampaign[j].store.name+'","fishCutting": '+productCampaign[j].fishCutting+',"meatCutting": '+productCampaign[j].meatCutting+',"limitUnit": '+(void 0===productCampaign[j].limitUnits?"0":productCampaign[j].limitUnits)+"}"):'{"id": '+productCampaign[j].id+',"name": "'+productCampaign[j].name+'","slug": "'+productCampaign[j].slug+'","manufacturer": "'+productCampaign[j].manufacturer.slug+'","oferta": false,"price": "'+productPrice+'","originalPrice": "","image": "'+productCampaign[j].principalImage.midResRoute+'","images": ["'+productCampaign[j].principalImage.midResRoute+'"],"coupons": '+coupons+',"storeSlug": "'+productCampaign[j].store.slug+'","store": "'+productCampaign[j].store.firstname+'","fishCutting": '+productCampaign[j].fishCutting+',"meatCutting": '+productCampaign[j].meatCutting+',"limitUnit": '+(void 0===productCampaign[j].limitUnits?"0":productCampaign[j].limitUnits)+"}"),productCampaignDom=createUpSellingItem(JSON.parse(productCampaignData.replace(/&quot;/g,'"'))),$(".js-cart-"+carts[i].store.slug).prepend(productCampaignDom)}}}(data.masterCart.carts),void 0!==$modal){var productUnits=Number($modal.find(".item-selection-units").html());$modal.find(".item-selection-units").html(productUnits),null!==product.limitUnit&&productUnits>=product.limitUnit?($modal.find(".js-add-product-popup").addClass("disabled").attr("disabled",!0),$modal.modal("hide")):$modal.find(".js-add-product-popup").hasClass("disabled")&&$modal.find(".js-add-product-popup").removeClass("disabled").attr("disabled",!1),isMobile.any()||$("#cart-sidebar").removeClass("hidden")}var currentUrl=getCurrentUrl($thisBtn);logProductAction(product.id,data.cartId,add_product_action,currentUrl,items)}}else{var $limitUnitsDOM=$('<div class="container-alert"><div class="alert alert-danger alert-dismissible animated fadeInDown" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>¡Vaya! Parece que no hemos podido añadir el producto a la cesta. Inténtalo de nuevo más tarde</div></div>');$(".wrapp-all").append($limitUnitsDOM)}})}fixed.bind("touchmove",function(e){e.preventDefault()},!1),$(window).width()>=$xs&&$btnContinue.length&&($(document).scroll(function(){checkOffset()}),checkOffset()),$mainContent.on("checkCartToggle",function(){isMobile.any()||"true"!==Cookies.get("cartToggle")||(Cookies.set("cartToggle",!1,{path:"/",expires:7}),triggerCart())}).on("click",".js-collapsable-delivery",function(){$(this).prevAll("div.js-collapse-trigger").slideDown("fast"),$(this).collapse("hide")}).on("click",".js-collapse-trigger",function(){$(this).slideUp("fast")}),$(window).on("resize",function(){var $cartContainer=$(".js-cart-container"),$cartHeightComputed=$(window).height()-175;clearTimeout(resizeTimer),resizeTimer=setTimeout(function(){$cartContainer.css("height",$cartHeightComputed)},250)}),window.renderCartSidebarPartial=function(cartUrl,cartDomContainer){var currentStore=$(".js-active-store").data("store");$.ajax({url:cartUrl,cache:!1,data:currentStore}).done(function(result){$(cartDomContainer).replaceWith(result),$(".js-cart-item").each(function(index,element){var product,quantity,$modal,productCart=$(this).data("product"),itemsInCart=Number($(element).find(".item-selection-units").html());updateProductUnits(productCart,itemsInCart),product=productCart,quantity=itemsInCart,$modal=$("#itemModal"),void 0!==$("#itemModal").data("bs.modal")&&$modal.data("bs.modal").isShown&&parseInt(product.id)===parseInt($modal.data("id"))&&$modal.find(".item-selection-units").text(quantity)}),$(cartDomContainer).trigger("checkCartToggle"),$(cartDomContainer).trigger("resize"),$(".load-cart").fadeOut(500,function(){$(this).remove()}),$(".js-control-cart").on("click",function(){triggerCart()}),$(".js-menu-trigger").on("click",function(){$("#cart-sidebar").hasClass("hidden")||triggerCart()}),$(".js-close-cart").on("click",function(){triggerCart(),$btnContinue.length&&$($btnContinue).removeClass("hidden")})})},$("main").on("click",".js-add-product",function(event){event.preventDefault();var $masterCartTotalItems=$("#cart-sidebar").find(".js-cart-item").length,product=getProductObject($(event.target));if(isPostalCodeFlagCookieSetted()){var $thisBtn=$(this);addGroupedProductsToCart(product,$thisBtn),$thisBtn.hasClass("js-recommended-product")&&function(product){$.ajax({url:g_url_recommended_product_add_log,data:{productId:product.id,cartId:product.idCart},method:"POST",async:!0})}(product),0===$masterCartTotalItems&&NewsletterReminder.initialize()}else event.stopPropagation(),appendProductIdToHiddenInput(product),showPostalCodeModal();disableCartEdition($(".js-edit-cart"))}).on("click",".js-remove-product",function(event){if(event.preventDefault(),isPostalCodeFlagCookieSetted()){var product=getProductObject($(event.target));if(1===$("#itemCart-"+product.id).length)removeGroupedProductsFromCart(product,$(this))}else event.stopPropagation(),showPostalCodeModal()}).on("click",".js-remove-line",function(event){(event.preventDefault(),isPostalCodeFlagCookieSetted())?function(product,$thisBtn){var $loading=$(".merchant-cart-"+product.storeSlug).find(".js-product-loading-cart"),$product=$("#itemCart-"+product.id);(eraseUrl=g_url_erase_product,productId=product.id,$.ajax({url:eraseUrl.replace("0000",productId),context:document.body,beforeSend:function(){$loading.show()}})).done(function(data){if(!1!==data.success){var itemsToDelete=Number($product.find(".item-selection-units").html());blinkCart(),$loading.hide(),updateProductUnits(product,-itemsToDelete),refreshCart(data.masterCart),currentCarts.setData=data.masterCart.carts,$product.remove(),modifyCartHeader(product.storeSlug);var currentUrl=getCurrentUrl($thisBtn);logProductAction(product.id,data.cartId,remove_product_action,currentUrl,itemsToDelete)}});var eraseUrl,productId}(getProductObject($(event.target)),$(this)):(event.stopPropagation(),showPostalCodeModal())}).on("click",".js-remove-cart",function(event){event.preventDefault();var triggerEvent,cart=(triggerEvent=$(event.target),$(triggerEvent).closest("[data-cart]").data("cart"));!function(stringId,cart){var $loading=$(".merchant-cart-"+cart.storeSlug).find(".js-product-loading-cart");(removeUrl=g_url_remove_cart,id=stringId,$.ajax({url:removeUrl,data:{id:id},method:"POST",async:!0,context:document.body,beforeSend:function(){$loading.show()}})).done(function(data){if(!1!==data.success){for(var i in cart.products){var id=cart.products[i];if(document.querySelector("#itemProduct-"+id)){var $product=$("#itemProduct-"+id),productData=$product.data("product"),itemsToDelete=Number($product.find(".item-selection-units").html());updateProductUnits(productData,-itemsToDelete)}}blinkCart(),$loading.hide(),refreshCart(data.masterCart),currentCarts.setData=data.masterCart.carts,$(".merchant-cart-"+cart.storeSlug).remove()}else $loading.hide()});var removeUrl,id}($(this).attr("data-id"),cart)}).on("click",".js-remove-cart-item-campaign",function(event){if(event.preventDefault(),isPostalCodeFlagCookieSetted()){var upsellingProduct=$(event.target).closest("[data-product]").data("product");$("#cartItemCampaign-"+upsellingProduct.id).remove(),Cookies.set("storeCampaignCartProduct-"+upsellingProduct.id,1,{path:"/",expires:1})}else event.stopPropagation(),showPostalCodeModal()}).on("click",".js-checkout-button",function(event){if(event.preventDefault(),isPostalCodeFlagCookieSetted()){if($(this).hasClass("disabled")){var $cartAlert=$(".cartDontReachMinOrderAlert"),$cartAlertMsg=$(".cartDontReachMinOrderMessage");if(hasCurrentStoreFastDelivery&&!isCurrentStoreOpen)return showCheckoutButtonAlert($cartAlert=$(".currentStoreIsClosedAlert"),$cartAlertMsg=$(".currentStoreIsClosedMessage")),!1;if(showCheckoutButtonAlert($cartAlert,$cartAlertMsg),$("#continuePurchase").attr("href","javascript:void(0)"),null!==currentCarts.data){$messagesContent=$("#carts-minimum-purchase-message"),$messagesContent.empty();for(var changeLinkButtonContinuePurchase=!0,i=0;i<currentCarts.data.length;i++){0<(substract=(cart=currentCarts.data[i]).store.minimumOrder-cart.productAmount.amount)&&substract<cart.store.minimumOrder&&_slug_store==cart.store.slug&&(changeLinkButtonContinuePurchase=!1)}var changedMessage=!1;for(i=0;i<currentCarts.data.length;i++){var cart,substract;0<(substract=(cart=currentCarts.data[i]).store.minimumOrder-cart.productAmount.amount)&&substract<cart.store.minimumOrder&&($messagesContent.append('<p>En <a href="'+cart.store.slug+'">'+cart.store.firstname+"</a> te faltan "+(substract/100).toFixed(2).replace(".",",")+" &euro;.</p>"),changeLinkButtonContinuePurchase&&0==changedMessage&&(changedMessage=!0,$("#continuePurchase").attr("href","/"+cart.store.slug)))}}return!1}window.location.href=g_url_checkout}else event.stopPropagation(),showPostalCodeModal()}).on("click",".js-edit-cart",function(){$(this).hasClass("open-edit")?function(button){if(button.hasClass("open-edit")){var $cartHeader=$(".cart-header");$cartHeader.addClass("edit-on"),button.addClass("close-edit").removeClass("open-edit").text("Cerrar edición").prepend('<span class="close-btn"></span>')}}($(this)):disableCartEdition($(this)),$(".cart-empty").hasClass("hidden")||disableCartEdition($(this))}),$(".js-close-zip, .header-bottom, .header-bottom-delithings, .logo, .js-zip, .nav-right.db-flex").on("click",function(event){$(".db-overlay").removeClass("is-visible")}),$(".db-overlay").on("click",function(event){$(this).removeClass("is-visible")});var createUpSellingItemDOM=document.createElement("script");function disableCartEdition(button){button.hasClass("close-edit")&&($(".cart-header").removeClass("edit-on"),button.removeClass("close-edit").addClass("open-edit").text("Editar carrito").prepend('<svg class="svg svg--grey"><use xlink:href="/bundles/deliberrystoretemplate/SVG/icons-sprite.svg#icon-new-edit"></use></svg>'))}function refreshCart(masterCart){for(var carts=masterCart.carts,cartsLength=carts.length,cartReachMinOrder=!0,$masterCartDeliveryFee=$(".js-mastercart-df"),$checkoutBtn=$(".js-checkout-button"),currencySymbol=masterCart.amount.currency.symbol,mastercartTotalAmount=((masterCart.productAmount.amount/100).toFixed(2)+"").replace(".",",")+" "+currencySymbol,mastercartItemsNum=masterCart.quantity,masterCartShippingAmount=((masterCart.shippingAmount.amount/100).toFixed(2)+"").replace(".",",")+" "+currencySymbol,i=0;i<cartsLength;++i){var $theCart=$("#cart-"+carts[i].id),storeAmountConverted=((carts[i].productAmount.amount/100).toFixed(2)+"").replace(".",","),minimumAmount=$theCart.find("span.js-store-min-order").html(),lines=carts[i].cartLines,linesLength=lines.length,cartId=carts[i].id;if(void 0!==carts[i].messages)for(var messageIds=0;messageIds<carts[i].messages.length;++messageIds){var div=document.createElement("div");div.className="container-alert",div.innerHTML='<div class="alert alert-danger alert-dismissible animated fadeInDown" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>'+carts[i].messages[messageIds].text+"</div>",document.body.appendChild(div)}parseInt(minimumAmount)>parseInt(storeAmountConverted)&&(cartReachMinOrder=!1),$theCart.find(".js-amount-merchant").html(storeAmountConverted+" "+currencySymbol),$.ajax({url:g_url_store_cart_delivery_fee_preview.replace("0000",cartId),method:"GET",indexValue:cartId,async:!0,success:function(data){$("#cart-"+this.indexValue+"-delivery-fee-container").replaceWith(data)}});for(var productIds=[],j=0;j<linesLength;++j){$("#itemCart-"+lines[j].product.id).find(".item-selection-units").html(lines[j].quantity);var price=(lines[j].amount/100).toFixed(2);if(price=(price+"").replace(".",","),$("#itemCart-"+lines[j].product.id).find(".price").html(price+" "+currencySymbol),productIds.push(lines[j].product.id),0<lines[j].product.coupons.length||0!==lines[j].product.reducedPrice){var originalPrice=(lines[j].product.price*lines[j].quantity/100).toFixed(2);originalPrice=(originalPrice+"").replace(".",",");var elementPrice=$("#itemCart-"+lines[j].product.id);elementPrice.find(".js-original-price").html(price!==originalPrice?originalPrice+" "+currencySymbol:""),elementPrice.find(".price").addClass("offer-price")}}!function(productIds,cart){var cartData={id:cart.id,storeSlug:cart.store.slug,products:productIds};$("#cart-"+cart.id+" .cart-header").attr("data-cart",JSON.stringify(cartData))}(productIds,carts[i])}$(".js-mastercart-amount").html(mastercartTotalAmount),0===mastercartItemsNum?($(".js-mastercart-items").addClass("hidden"),$(".js-count-stores").text(""),$(".cart-empty").removeClass("hidden"),$masterCartDeliveryFee.html("-"),$checkoutBtn.addClass("disabled"),disableCartEdition($(".js-edit-cart"))):($(".js-mastercart-items").html(mastercartItemsNum).removeClass("hidden"),$(".js-count-stores").text("en "+cartsLength+" tienda"+(1<cartsLength?"s":"")),$masterCartDeliveryFee.html(masterCartShippingAmount),!cartReachMinOrder||hasCurrentStoreFastDelivery&&!isCurrentStoreOpen?$checkoutBtn.addClass("disabled"):$checkoutBtn.removeClass("disabled"))}createUpSellingItemDOM.type="text/javascript",createUpSellingItemDOM.src=g_create_up_selling_item_js,document.head.prepend(createUpSellingItemDOM);var defaultFunctionConvertCart=function(){$.ajax({url:g_url_fast_delivery_cart_convert_to_marketplace,data:{productId:convertFastDeliveryCartToMarketPlaceProductId,quantityRemaining:convertFastDeliveryCartToMarketPlaceQuantityRemaining},method:"POST",async:!0,context:document.body,beforeSend:function(){closeModalsConvertCart(),setupModal("Estamos pasando tu cesta a la tienda 1 hora","bg--updating_cart")}}).done(function(data){void 0!==data.toStoreSlug&&(window.location.href="/"+data.toStoreSlug),void 0===data.toStoreSlug&&closeModal()})};confirmedProductsNotFoundConvertFastDeliveryCartToMarketplace.onclick=defaultFunctionConvertCart,document.getElementById("modalDialogConfirmProductsNotFoundConvertToMarketPlace").classList.add("hiddeModal");for(var fadeOutFadeInModalsConvertCart=function(){var modalDialogConvertToMarketPlace=document.getElementById("modalDialogConvertToMarketPlace"),modalDialogConfirmProductsNotFoundConvertToMarketPlace=document.getElementById("modalDialogConfirmProductsNotFoundConvertToMarketPlace");modalDialogConvertToMarketPlace.classList.remove("showModal"),modalDialogConvertToMarketPlace.classList.add("hiddeModal"),modalDialogConfirmProductsNotFoundConvertToMarketPlace.classList.remove("hiddeModal"),modalDialogConfirmProductsNotFoundConvertToMarketPlace.classList.add("fadeInLeft"),$("#cancelFastDeliveryCartToMarketplaceNotFoundProductSubText").css("width",document.getElementById("cancelFastDeliveryCartToMarketplaceNotFoundProducts").offsetWidth+"px"),$.ajax({url:g_url_log_action_convert_cart_show_not_found_products_modal,method:"POST",async:!0,context:document.body})},closeModalsConvertCart=function(){var modalConvertToMarketPlace=document.getElementById("modalConvertToMarketPlace"),modalDialogConvertToMarketPlace=document.getElementById("modalDialogConvertToMarketPlace"),modalDialogConfirmProductsNotFoundConvertToMarketPlace=document.getElementById("modalDialogConfirmProductsNotFoundConvertToMarketPlace");modalConvertToMarketPlace.classList.remove("showModal"),modalDialogConvertToMarketPlace.classList.remove("showModal"),modalDialogConvertToMarketPlace.classList.remove("hiddeModal"),modalDialogConfirmProductsNotFoundConvertToMarketPlace.classList.remove("showModal"),modalDialogConfirmProductsNotFoundConvertToMarketPlace.classList.remove("fadeInLeft"),modalDialogConfirmProductsNotFoundConvertToMarketPlace.classList.add("hiddeModal")},i=0;i<document.getElementsByClassName("closeModalsConvertCart").length;i++)document.getElementsByClassName("closeModalsConvertCart")[i].onclick=closeModalsConvertCart;function updateProductUnits(product,quantity){if(document.querySelector("#itemProduct-"+product.id)){var $productItem=$("#itemProduct-"+product.id),newProductUnits=Number($productItem.find(".item-selection-units").html())+quantity;if($productItem.find(".item-selection-units").html(newProductUnits),$productItem.find(".item-qty span").html(newProductUnits),0<newProductUnits){if($productItem.find(".item-qty").removeClass("hidden"),null!==product.limitUnit){var $addItemBtn=$productItem.find(".js-add-product");!function(limitUnit,newProductUnits,$addItemBtn){var $containerAlert=$(".container-alert"),$limitUnitsDOM=$('<div class="container-alert"><div class="alert alert-danger alert-dismissible animated fadeInDown" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>¡Vaya! Has llegado al máximo de unidades de este de producto. Puedes seguir comprando otros producto, o finalizar tu compra. Gracias por tu comprensión.</div></div>');null!==limitUnit&&limitUnit<=newProductUnits?$addItemBtn.addClass("disabled"):$addItemBtn.removeClass("disabled");$(document).ajaxStop(function(){null!==limitUnit&&limitUnit<=newProductUnits?(Cookies.get("alert-limit-shown")||(Cookies.set("alert-limit-shown",1),$addItemBtn.addClass("disabled")),Cookies.get("alert-limit-shown-pop-up")||(Cookies.set("alert-limit-shown-pop-up",!0,{expires:1}),$(".wrapp-all").append($limitUnitsDOM))):($containerAlert.remove(),Cookies.remove("alert-limit-shown"),$addItemBtn.removeClass("disabled"))})}(product.limitUnit,newProductUnits,$addItemBtn)}}else $productItem.find(".item-qty").addClass("hidden")}}function modifyCartHeader(store){0===$(".js-cart-"+store).find(".js-cart-item").length&&$(".merchant-cart-"+store).remove()}function blinkCart(){var $cartBadge=$(".js-mastercart-amount");$cartBadge.removeClass("blink-cart-badge").width(),$cartBadge.addClass("blink-cart-badge")}function addGroupedProductsToCart(product,$thisBtn,$modal){var key=product.id;void 0===productsMod[key]&&(productsMod[key]=0),productsMod[key]=productsMod[key]+1,updateProductUnits(product,1),-1==$.inArray(product,pendingProduct)&&pendingProduct.push(product),$(".merchant-cart-"+product.storeSlug).length||function(product,$thisBtn){$(".js-add-product").not($thisBtn).not(".disabled").addClass("disabled")}(0,$thisBtn),clearTimeout(clickTimeout),clickTimeout=setTimeout(function(){pendingProduct.forEach(function(item){addProductToCart(item,$modal,$thisBtn)}),pendingProduct=[]},1e3)}function removeGroupedProductsFromCart(product,$thisBtn){void 0===productsMod[product.id]&&(productsMod[product.id]=0),0<$thisBtn.parent().find(".item-selection-units").html()&&(productsMod[product.id]=productsMod[product.id]-1,updateProductUnits(product,-1)),-1==$.inArray(product,pendingProduct)&&pendingProduct.push(product),clearTimeout(clickTimeout),clickTimeout=setTimeout(function(){pendingProduct.forEach(function(item){!function(product,$thisBtn){var $loading=$(".merchant-cart-"+product.storeSlug).find(".js-product-loading-cart"),$product=$("#itemCart-"+product.id),itemsPresent=Number($product.find(".item-selection-units").html()),itemsToDelete=Math.abs(productsMod[product.id]);if(itemsToDelete===itemsPresent&&!1===confirm("¿Quieres eliminar el producto de la cesta?"))return;ajaxModifyCart({ajaxUrl:g_url_remove_product.replace("0000",product.id),productId:product.id,items:itemsToDelete,spinner:$loading,btn:$thisBtn}).done(function(data){if(productsMod[product.id]=0,!1!==data.success){blinkCart(),$thisBtn.removeClass("disabled"),$loading.hide(),refreshCart(data.masterCart),currentCarts.setData=data.masterCart.carts;var currentUrl=getCurrentUrl($thisBtn);logProductAction(product.id,data.cartId,remove_product_action,currentUrl,itemsToDelete)}else{var $limitUnitsDOM=$('<div class="container-alert"><div class="alert alert-danger alert-dismissible animated fadeInDown" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>¡Vaya! Parece que no hemos podido eliminar el producto de la cesta. Inténtalo de nuevo más tarde</div></div>');$(".wrapp-all").append($limitUnitsDOM)}}),itemsToDelete===itemsPresent&&($product.remove(),modifyCartHeader(product.storeSlug))}(item,$thisBtn)}),pendingProduct=[]},1e3)}function getCurrentUrl($thisBtn){var location=window.location.href;return $thisBtn.hasClass("product-by-cart")&&(location+="&cart="),$thisBtn.hasClass("send-conversion")&&($thisBtn.closest("ul").hasClass("results-search")?location=location+"&search="+previousSearchTerm:$thisBtn.hasClass("product-by-cross-selling")&&(location=location+"&search-cross-selling="+previousSearchTerm)),($thisBtn.hasClass("js-add-product-popup")||$thisBtn.hasClass("js-remove-product-popup"))&&(location+="&productModal="),$thisBtn.hasClass("js-recommended-product")&&(location+="&upselling="),location}function logProductAction(productId,cartId,action,currentUrl,units){$.ajax({url:url_cart_product_log,data:{action:action,cartId:cartId,productId:productId,units:units,referrer:currentUrl},method:"POST",async:!0})}function appendProductIdToHiddenInput(product){document.getElementsByClassName("change-with-product")[0].setAttribute("value",product.id)}$("#itemModal").on("show.bs.modal",function(event){var $modal=$(this),product=$(event.relatedTarget).closest("[data-product]").data("product")||$("#productPageInfo").data("product");product.selectedUnits=Number($(event.relatedTarget).parent().find(".item-selection-units").html())||0,function(product){var description=product.name+" de "+product.store+" en Deliberry.com. Hacemos la compra por ti y te la llevamos a casa en 1 hora.",seoTitle="Comprar "+product.name+" "+product.manufacturer+" de "+product.store+" en Deliberry.com";""!==product.dimensions?description=description.concat(" Dimensiones: "+product.dimensions):""!==product.weigth?description=description.concat(" Peso: "+product.weigth):""!==product.type&&"0"!==product.type&&(description=description.concat(" Categoria: "+product.type)),document.title=seoTitle,$(document).find('[name="description"]').attr("content",description)}(product),$modal.find(".js-product-img-container").html(function(images){var productImages="",thumbnailImages="",zoomUrl="resize/"+zoomWidth+"/"+zoomHeight;images.forEach(function(value,index,array){var zoom="js-zoom-img";!0===value.includes(zoomUrl)&&(zoom=""),productImages+='<li class="splide__slide '+zoom+'"><img src="'+value+'"></li>',thumbnailImages+='<li class="splide__slide"><img src="'+value+'"></li>'});var zoomInfo='<p class="mb-m fz-xs js-zoom-help">(Mueve el puntero por la imagen para agrandarla)</p>';return!0===images[0].includes(zoomUrl)&&(zoomInfo=""),'<div id="main-slider" class="splide"><div class="splide__track"><ul class="splide__list">'+productImages+"</ul></div></div>"+zoomInfo+'<div id="thumbnail-slider" class="splide"><div class="splide__track"><ul class="splide__list">'+thumbnailImages+"</ul></div></div>"}(product.images));var main=new Splide("#main-slider",{type:"fade",rewind:!0,pagination:!1,arrows:!1}),thumbnails=new Splide("#thumbnail-slider",{fixedWidth:90,fixedHeight:90,arrows:!1,rewind:!0,pagination:!1,cover:!0,isNavigation:!0});main.sync(thumbnails),main.mount(),thumbnails.mount();var $furtherInformation=$modal.find(".item-further-info"),$addProductBtnModal=$modal.find(".js-add-product-popup"),productSlug=product.slug;if(-1===window.location.href.indexOf("/"+productSlug)){var new_url=$(document).find("#href-item-"+product.id).attr("href");window.history.pushState("","",new_url)}if($modal.find(".item-info").attr("data-slug",productSlug),$modal.find(".item-name").html(product.name),$modal.find(".item-price").text(product.price),$modal.find(".item-manufacturer").html(product.manufacturer),$modal.find(".item-selection-units").text(product.selectedUnits),$modal.data("id",product.id),null!==product.limitUnit&&product.selectedUnits>=product.limitUnit?$addProductBtnModal.addClass("disabled").attr("disabled",!0):$addProductBtnModal.removeClass("disabled").attr("disabled",!1),$furtherInformation.html(""),!1!==product.hasFurtherInformation){var url=Routing.generate("store_product_info",{slug:product.fromStoreSlug,productId:product.id});$furtherInformation.html('<span class="db-spinner mt-xl"></span>'),$.get(url,function(response){$furtherInformation.html(response),$(".product-slogan").removeClass("d-n")}).fail(function(){$furtherInformation.html("")})}else $(".product-slogan").addClass("d-n");$(".js-zoom-img").zoom({magnify:.8}),$addProductBtnModal.unbind("click"),$addProductBtnModal.click(function(){if(isPostalCodeFlagCookieSetted()){var $thisBtn=$(this);addGroupedProductsToCart(product,$thisBtn,$modal);var productUnits=Number($modal.find(".item-selection-units").html());$modal.find(".item-selection-units").html(productUnits+1);var newProductUnits=productUnits+1;0<=newProductUnits&&($modal.find(".item-selection-units").html(newProductUnits),null!==product.limitUnit&&newProductUnits>=product.limitUnit?$addProductBtnModal.addClass("disabled").attr("disabled",!0):$addProductBtnModal.removeClass("disabled").attr("disabled",!1))}else appendProductIdToHiddenInput(product),$("#modalPostalCode").modal()}),$modal.find(".js-remove-product-popup").unbind("click"),$modal.find(".js-remove-product-popup").click(function(){if(isPostalCodeFlagCookieSetted()){var $thisBtn=$(this);removeGroupedProductsFromCart(product,$thisBtn);var newProductUnits=Number($modal.find(".item-selection-units").html())-1;0<=newProductUnits&&($modal.find(".item-selection-units").html(newProductUnits),null!==product.limitUnit&&newProductUnits<product.limitUnit&&$addProductBtnModal.hasClass("disabled")&&($addProductBtnModal.removeClass("disabled"),$addProductBtnModal.attr("disabled",!1)))}else $("#modalPostalCode").modal()})}),$("#itemModal").on("hide.bs.modal",function(){var $modal=$(this),$zoomImage=$(".js-zoom-img"),pageUrl=$modal.data("url");window.history.pushState("","",pageUrl),document.title="deliberry - Compra online",$(document).find('[name="description"]').attr("content","Compra Online en tu Supermercado Favorito | Productos Frescos | Selección Personalizada | Entrega en 1 hora o cuando tú decidas | Primer envío gratis"),$zoomImage.trigger("zoom.destroy"),$modal.find(".js-modal-product-img").prop({src:"",width:"",height:""})}),$(document.body).on("click",".js-show-instructions",function(e){e.preventDefault();var $this=$(this);$this.addClass("hide"),$this.next().removeClass("hide"),$this.siblings(".js-note-content").addClass("hide"),$this.siblings(".js-cutting-intructions-box").addClass("hide"),$this.siblings(".cutting-instruction-container").children(".js-cutting-intructions-box").addClass("hide"),$this.siblings(".cutting-instruction-container").children(".js-show-cutting-instructions").removeClass("hide")}),$(document.body).on("blur",".js-save-instructions",function(e){e.preventDefault();var $this=$(this),id=$this.data("line"),urlItemNote=g_url_cartline_add_instructions,$showInstructions=$this.closest(".item-name").find(".js-show-instructions");urlItemNote=urlItemNote.replace("0000",id);var cartLineInstructions=$("#instructions-message-"+id).val();$.post(urlItemNote,{cartLineInstructions:cartLineInstructions},function(){$this.closest(".js-intructions-box").addClass("hide"),$this.closest(".item-name").find(".js-note-content").empty().append(cartLineInstructions).removeClass("hide"),$showInstructions.removeClass("hide").text("Editar nota"),$this.closest(".item-name").find(".js-cutting-intructions-box").addClass("hide"),$this.closest(".item-name").find(".js-show-cutting-instructions").removeClass("hide")})}),$(document.body).on("click",".js-close-instructions",function(e){e.preventDefault(),$(this).closest(".js-intructions-box").addClass("hide"),$(this).closest(".item-name").find(".js-show-instructions").removeClass("hide"),$(this).closest(".item-name").find(".js-note-content").removeClass("hide"),$(this).closest(".item-name").find(".js-cutting-intructions-box").addClass("hide"),$(this).closest(".item-name").find(".js-show-cutting-instructions").removeClass("hide")}),$(document.body).on("click",".js-show-cutting-instructions",function(e){e.preventDefault();var $this=$(this);$this.addClass("hide"),$this.siblings(".js-cutting-intructions-note").addClass("hide"),$this.siblings(".js-cutting-intructions-box").removeClass("hide"),$this.closest(".item-name").find(".js-show-instructions").removeClass("hide"),$this.closest(".item-name").find(".js-intructions-box").addClass("hide")}),$(document.body).on("change",".cutting-instructions-select",function(e){e.preventDefault();var $this=$(this),id=$this.data("line"),urlItemNote=g_url_cartline_add_cutting_instructions,$showInstructions=$this.closest(".item-name").find(".js-show-cutting-instructions"),cuttingInstructionId=$("#cutting-instruction-"+id).val(),cuttingInstructionValue=$("#cutting-instruction-"+id+" option:selected").html();if(""==cuttingInstructionId)return!1;urlItemNote=(urlItemNote=urlItemNote.replace("0000",id)).replace("1111",cuttingInstructionId),$.post(urlItemNote,function(){$this.closest(".js-cutting-intructions-box").addClass("hide"),$this.closest(".item-name").find(".js-cutting-intructions-note").empty().append(cuttingInstructionValue).removeClass("hide"),$showInstructions.removeClass("hide").text("Editar tipo de corte")})}),$(".js-item-seo-href").click(function(event){event.preventDefault()}),$(".js-delivery-fee").click(function(){$.ajax({url:g_url_delivery_fee_click,method:"POST",async:!0})}),$("#wishlistModal").on("shown.bs.modal",function(){$.ajax({url:g_url_wishlist_click,method:"POST",async:!0})})}),function(root,factory){"use strict";"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof exports?module.exports=factory(require("jquery")):root.bootbox=factory(root.jQuery)}(this,function init($,undefined){"use strict";var hasOwnProperty,hasDontEnumBug,dontEnums,dontEnumsLength;Object.keys||(Object.keys=(hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),dontEnumsLength=(dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(obj){if("function"!=typeof obj&&("object"!=typeof obj||null===obj))throw new TypeError("Object.keys called on non-object");var prop,i,result=[];for(prop in obj)hasOwnProperty.call(obj,prop)&&result.push(prop);if(hasDontEnumBug)for(i=0;i<dontEnumsLength;i++)hasOwnProperty.call(obj,dontEnums[i])&&result.push(dontEnums[i]);return result}));var exports={};exports.VERSION="5.0.0";var locales={},templates={dialog:'<div class="bootbox modal" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-body"><div class="bootbox-body"></div></div></div></div></div>',header:'<div class="modal-header"><h5 class="modal-title"></h5></div>',footer:'<div class="modal-footer"></div>',closeButton:'<button type="button" class="bootbox-close-button close" aria-hidden="true">&times;</button>',form:'<form class="bootbox-form"></form>',button:'<button type="button" class="btn"></button>',option:"<option></option>",promptMessage:'<div class="bootbox-prompt-message"></div>',inputs:{text:'<input class="bootbox-input bootbox-input-text form-control" autocomplete="off" type="text" />',textarea:'<textarea class="bootbox-input bootbox-input-textarea form-control"></textarea>',email:'<input class="bootbox-input bootbox-input-email form-control" autocomplete="off" type="email" />',select:'<select class="bootbox-input bootbox-input-select form-control"></select>',checkbox:'<div class="form-check checkbox"><label class="form-check-label"><input class="form-check-input bootbox-input bootbox-input-checkbox" type="checkbox" /></label></div>',radio:'<div class="form-check radio"><label class="form-check-label"><input class="form-check-input bootbox-input bootbox-input-radio" type="radio" name="bootbox-radio" /></label></div>',date:'<input class="bootbox-input bootbox-input-date form-control" autocomplete="off" type="date" />',time:'<input class="bootbox-input bootbox-input-time form-control" autocomplete="off" type="time" />',number:'<input class="bootbox-input bootbox-input-number form-control" autocomplete="off" type="number" />',password:'<input class="bootbox-input bootbox-input-password form-control" autocomplete="off" type="password" />',range:'<input class="bootbox-input bootbox-input-range form-control-range" autocomplete="off" type="range" />'}},defaults={locale:"en",backdrop:"static",animate:!0,className:null,closeButton:!0,show:!0,container:"body",value:"",inputType:"text",swapButtonOrder:!1,centerVertical:!1,multiple:!1,scrollable:!1};function mergeArguments(defaults,args,properties){return $.extend(!0,{},defaults,function(args,properties){var argn=args.length,options={};if(argn<1||2<argn)throw new Error("Invalid argument length");return 2===argn||"string"==typeof args[0]?(options[properties[0]]=args[0],options[properties[1]]=args[1]):options=args[0],options}(args,properties))}function mergeDialogOptions(className,labels,properties,args){var locale;args&&args[0]&&(locale=args[0].locale||defaults.locale,(args[0].swapButtonOrder||defaults.swapButtonOrder)&&(labels=labels.reverse()));var options,buttons,allowedButtons,baseOptions={className:"bootbox-"+className,buttons:function(labels,locale){for(var buttons={},i=0,j=labels.length;i<j;i++){var argument=labels[i],key=argument.toLowerCase(),value=argument.toUpperCase();buttons[key]={label:getText(value,locale)}}return buttons}(labels,locale)};return options=mergeArguments(baseOptions,args,properties),allowedButtons={},each(buttons=labels,function(key,value){allowedButtons[value]=!0}),each(options.buttons,function(key){if(allowedButtons[key]===undefined)throw new Error('button key "'+key+'" is not allowed (options are '+buttons.join(" ")+")")}),options}function getText(key,locale){var labels=locales[locale];return labels?labels[key]:locales.en[key]}function getKeyLength(obj){return Object.keys(obj).length}function each(collection,iterator){var index=0;$.each(collection,function(key,value){iterator(key,value,index++)})}function processCallback(e,dialog,callback){e.stopPropagation(),e.preventDefault(),$.isFunction(callback)&&!1===callback.call(dialog,e)||dialog.modal("hide")}function timeIsValid(value){return/([01][0-9]|2[0-3]):[0-5][0-9]?:[0-5][0-9]/.test(value)}function dateIsValid(value){return/(\d{4})-(\d{2})-(\d{2})/.test(value)}return exports.locales=function(name){return name?locales[name]:locales},exports.addLocale=function(name,values){return $.each(["OK","CANCEL","CONFIRM"],function(_,v){if(!values[v])throw new Error('Please supply a translation for "'+v+'"')}),locales[name]={OK:values.OK,CANCEL:values.CANCEL,CONFIRM:values.CONFIRM},exports},exports.removeLocale=function(name){if("en"===name)throw new Error('"en" is used as the default and fallback locale and cannot be removed.');return delete locales[name],exports},exports.setLocale=function(name){return exports.setDefaults("locale",name)},exports.setDefaults=function(){var values={};return 2===arguments.length?values[arguments[0]]=arguments[1]:values=arguments[0],$.extend(defaults,values),exports},exports.hideAll=function(){return $(".bootbox").modal("hide"),exports},exports.init=function(_$){return init(_$||$)},exports.dialog=function(options){if($.fn.modal===undefined)throw new Error('"$.fn.modal" is not defined; please double check you have included the Bootstrap JavaScript library. See http://getbootstrap.com/javascript/ for more details.');if(options=function(options){var buttons,total;if("object"!=typeof options)throw new Error("Please supply an object of options");if(!options.message)throw new Error('"message" option must not be null or an empty string.');(options=$.extend({},defaults,options)).buttons||(options.buttons={});return buttons=options.buttons,total=getKeyLength(buttons),each(buttons,function(key,button,index){if($.isFunction(button)&&(button=buttons[key]={callback:button}),"object"!==$.type(button))throw new Error('button with key "'+key+'" must be an object');if(button.label||(button.label=key),!button.className){var isPrimary=!1;isPrimary=options.swapButtonOrder?0===index:index===total-1,button.className=total<=2&&isPrimary?"btn-primary":"btn-secondary btn-default"}}),options}(options),$.fn.modal.Constructor.VERSION){options.fullBootstrapVersion=$.fn.modal.Constructor.VERSION;var i=options.fullBootstrapVersion.indexOf(".");options.bootstrap=options.fullBootstrapVersion.substring(0,i)}else options.bootstrap="2",options.fullBootstrapVersion="2.3.2",console.warn("Bootbox will *mostly* work with Bootstrap 2, but we do not officially support it. Please upgrade, if possible.");var dialog=$(templates.dialog),innerDialog=dialog.find(".modal-dialog"),body=dialog.find(".modal-body"),header=$(templates.header),footer=$(templates.footer),buttons=options.buttons,callbacks={onEscape:options.onEscape};if(body.find(".bootbox-body").html(options.message),0<getKeyLength(options.buttons)&&(each(buttons,function(key,b){var button=$(templates.button);switch(button.data("bb-handler",key),button.addClass(b.className),key){case"ok":case"confirm":button.addClass("bootbox-accept");break;case"cancel":button.addClass("bootbox-cancel")}button.html(b.label),footer.append(button),callbacks[key]=b.callback}),body.after(footer)),!0===options.animate&&dialog.addClass("fade"),options.className&&dialog.addClass(options.className),options.size)switch(options.fullBootstrapVersion.substring(0,3)<"3.1"&&console.warn('"size" requires Bootstrap 3.1.0 or higher. You appear to be using '+options.fullBootstrapVersion+". Please upgrade to use this option."),options.size){case"small":case"sm":innerDialog.addClass("modal-sm");break;case"large":case"lg":innerDialog.addClass("modal-lg");break;case"xl":case"extra-large":options.fullBootstrapVersion.substring(0,3)<"4.2"&&console.warn('Using size "xl"/"extra-large" requires Bootstrap 4.2.0 or higher. You appear to be using '+options.fullBootstrapVersion+". Please upgrade to use this option."),innerDialog.addClass("modal-xl")}if(options.scrollable&&(options.fullBootstrapVersion.substring(0,3)<"4.3"&&console.warn('Using "scrollable" requires Bootstrap 4.3.0 or higher. You appear to be using '+options.fullBootstrapVersion+". Please upgrade to use this option."),innerDialog.addClass("modal-dialog-scrollable")),options.title&&(body.before(header),dialog.find(".modal-title").html(options.title)),options.closeButton){var closeButton=$(templates.closeButton);options.title?3<options.bootstrap?dialog.find(".modal-header").append(closeButton):dialog.find(".modal-header").prepend(closeButton):closeButton.prependTo(body)}return options.centerVertical&&(options.fullBootstrapVersion<"4.0.0"&&console.warn('"centerVertical" requires Bootstrap 4.0.0-beta.3 or higher. You appear to be using '+options.fullBootstrapVersion+". Please upgrade to use this option."),innerDialog.addClass("modal-dialog-centered")),dialog.one("hide.bs.modal",function(e){e.target===this&&(dialog.off("escape.close.bb"),dialog.off("click"))}),dialog.one("hidden.bs.modal",function(e){e.target===this&&dialog.remove()}),dialog.one("shown.bs.modal",function(){dialog.find(".bootbox-accept:first").trigger("focus")}),"static"!==options.backdrop&&dialog.on("click.dismiss.bs.modal",function(e){dialog.children(".modal-backdrop").length&&(e.currentTarget=dialog.children(".modal-backdrop").get(0)),e.target===e.currentTarget&&dialog.trigger("escape.close.bb")}),dialog.on("escape.close.bb",function(e){callbacks.onEscape&&processCallback(e,dialog,callbacks.onEscape)}),dialog.on("click",".modal-footer button:not(.disabled)",function(e){var callbackKey=$(this).data("bb-handler");callbackKey!==undefined&&processCallback(e,dialog,callbacks[callbackKey])}),dialog.on("click",".bootbox-close-button",function(e){processCallback(e,dialog,callbacks.onEscape)}),dialog.on("keyup",function(e){27===e.which&&dialog.trigger("escape.close.bb")}),$(options.container).append(dialog),dialog.modal({backdrop:!!options.backdrop&&"static",keyboard:!1,show:!1}),options.show&&dialog.modal("show"),dialog},exports.alert=function(){var options;if((options=mergeDialogOptions("alert",["ok"],["message","callback"],arguments)).callback&&!$.isFunction(options.callback))throw new Error('alert requires the "callback" property to be a function when provided');return options.buttons.ok.callback=options.onEscape=function(){return!$.isFunction(options.callback)||options.callback.call(this)},exports.dialog(options)},exports.confirm=function(){var options;if(options=mergeDialogOptions("confirm",["cancel","confirm"],["message","callback"],arguments),!$.isFunction(options.callback))throw new Error("confirm requires a callback");return options.buttons.cancel.callback=options.onEscape=function(){return options.callback.call(this,!1)},options.buttons.confirm.callback=function(){return options.callback.call(this,!0)},exports.dialog(options)},exports.prompt=function(){var options,promptDialog,form,input,shouldShow,inputOptions;if(form=$(templates.form),(options=mergeDialogOptions("prompt",["cancel","confirm"],["title","callback"],arguments)).value||(options.value=defaults.value),options.inputType||(options.inputType=defaults.inputType),shouldShow=options.show===undefined?defaults.show:options.show,options.show=!1,options.buttons.cancel.callback=options.onEscape=function(){return options.callback.call(this,null)},options.buttons.confirm.callback=function(){var value;if("checkbox"===options.inputType)value=input.find("input:checked").map(function(){return $(this).val()}).get();else if("radio"===options.inputType)value=input.find("input:checked").val();else{if(input[0].checkValidity&&!input[0].checkValidity())return!1;value="select"===options.inputType&&!0===options.multiple?input.find("option:selected").map(function(){return $(this).val()}).get():input.val()}return options.callback.call(this,value)},!options.title)throw new Error("prompt requires a title");if(!$.isFunction(options.callback))throw new Error("prompt requires a callback");if(!templates.inputs[options.inputType])throw new Error("Invalid prompt type");switch(input=$(templates.inputs[options.inputType]),options.inputType){case"text":case"textarea":case"email":case"password":input.val(options.value),options.placeholder&&input.attr("placeholder",options.placeholder),options.pattern&&input.attr("pattern",options.pattern),options.maxlength&&input.attr("maxlength",options.maxlength),options.required&&input.prop({required:!0}),options.rows&&!isNaN(parseInt(options.rows))&&"textarea"===options.inputType&&input.attr({rows:options.rows});break;case"date":case"time":case"number":case"range":if(input.val(options.value),options.placeholder&&input.attr("placeholder",options.placeholder),options.pattern&&input.attr("pattern",options.pattern),options.required&&input.prop({required:!0}),"date"!==options.inputType&&options.step){if(!("any"===options.step||!isNaN(options.step)&&0<parseInt(options.step)))throw new Error('"step" must be a valid positive number or the value "any". See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#attr-step for more information.');input.attr("step",options.step)}(function(type,min,max){var result=!1,minValid=!0,maxValid=!0;if("date"===type)min===undefined||(minValid=dateIsValid(min))?max===undefined||(maxValid=dateIsValid(max))||console.warn('Browsers which natively support the "date" input type expect date values to be of the form "YYYY-MM-DD" (see ISO-8601 https://www.iso.org/iso-8601-date-and-time-format.html). Bootbox does not enforce this rule, but your max value may not be enforced by this browser.'):console.warn('Browsers which natively support the "date" input type expect date values to be of the form "YYYY-MM-DD" (see ISO-8601 https://www.iso.org/iso-8601-date-and-time-format.html). Bootbox does not enforce this rule, but your min value may not be enforced by this browser.');else if("time"===type){if(min!==undefined&&!(minValid=timeIsValid(min)))throw new Error('"min" is not a valid time. See https://www.w3.org/TR/2012/WD-html-markup-20120315/datatypes.html#form.data.time for more information.');if(max!==undefined&&!(maxValid=timeIsValid(max)))throw new Error('"max" is not a valid time. See https://www.w3.org/TR/2012/WD-html-markup-20120315/datatypes.html#form.data.time for more information.')}else{if(min!==undefined&&isNaN(min))throw new Error('"min" must be a valid number. See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#attr-min for more information.');if(max!==undefined&&isNaN(max))throw new Error('"max" must be a valid number. See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#attr-max for more information.')}if(minValid&&maxValid){if(max<=min)throw new Error('"max" must be greater than "min". See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#attr-max for more information.');result=!0}return result})(options.inputType,options.min,options.max)&&(options.min!==undefined&&input.attr("min",options.min),options.max!==undefined&&input.attr("max",options.max));break;case"select":var groups={};if(inputOptions=options.inputOptions||[],!$.isArray(inputOptions))throw new Error("Please pass an array of input options");if(!inputOptions.length)throw new Error('prompt with "inputType" set to "select" requires at least one option');options.placeholder&&input.attr("placeholder",options.placeholder),options.required&&input.prop({required:!0}),options.multiple&&input.prop({multiple:!0}),each(inputOptions,function(_,option){var elem=input;if(option.value===undefined||option.text===undefined)throw new Error('each option needs a "value" property and a "text" property');option.group&&(groups[option.group]||(groups[option.group]=$("<optgroup />").attr("label",option.group)),elem=groups[option.group]);var o=$(templates.option);o.attr("value",option.value).text(option.text),elem.append(o)}),each(groups,function(_,group){input.append(group)}),input.val(options.value);break;case"checkbox":var checkboxValues=$.isArray(options.value)?options.value:[options.value];if(!(inputOptions=options.inputOptions||[]).length)throw new Error('prompt with "inputType" set to "checkbox" requires at least one option');input=$('<div class="bootbox-checkbox-list"></div>'),each(inputOptions,function(_,option){if(option.value===undefined||option.text===undefined)throw new Error('each option needs a "value" property and a "text" property');var checkbox=$(templates.inputs[options.inputType]);checkbox.find("input").attr("value",option.value),checkbox.find("label").append("\n"+option.text),each(checkboxValues,function(_,value){value===option.value&&checkbox.find("input").prop("checked",!0)}),input.append(checkbox)});break;case"radio":if(options.value!==undefined&&$.isArray(options.value))throw new Error('prompt with "inputType" set to "radio" requires a single, non-array value for "value"');if(!(inputOptions=options.inputOptions||[]).length)throw new Error('prompt with "inputType" set to "radio" requires at least one option');input=$('<div class="bootbox-radiobutton-list"></div>');var checkFirstRadio=!0;each(inputOptions,function(_,option){if(option.value===undefined||option.text===undefined)throw new Error('each option needs a "value" property and a "text" property');var radio=$(templates.inputs[options.inputType]);radio.find("input").attr("value",option.value),radio.find("label").append("\n"+option.text),options.value!==undefined&&option.value===options.value&&(radio.find("input").prop("checked",!0),checkFirstRadio=!1),input.append(radio)}),checkFirstRadio&&input.find('input[type="radio"]').first().prop("checked",!0)}if(form.append(input),form.on("submit",function(e){e.preventDefault(),e.stopPropagation(),promptDialog.find(".bootbox-accept").trigger("click")}),""!==$.trim(options.message)){var message=$(templates.promptMessage).html(options.message);form.prepend(message),options.message=form}else options.message=form;return(promptDialog=exports.dialog(options)).off("shown.bs.modal"),promptDialog.on("shown.bs.modal",function(){input.focus()}),!0===shouldShow&&promptDialog.modal("show"),promptDialog},exports.addLocale("en",{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"}),exports}),CuttingInstruction=function(){"use strict";var cuttingInstructionsElement=function(lineId,list,type){return'<div class="cutting-instruction-container mt-s"><a href="#" class="c-orange js-show-cutting-instructions">+ Añadir tipo de corte</a><div class="js-cutting-intructions-box hide"><select class="cutting-instructions-select form-control" id="cutting-instruction-'+lineId+'" data-line="'+lineId+'" name=" '+type+' ">'+cuttingInstructionOptions(list)+'</select></div><div class="js-cutting-intructions-note bg-info"></div></div>'},cuttingInstructionOptions=function(list){var options="";for(var index in options+='<option value=""></option>',list){var element=list[index];options+='<option value="'+element.id+'">'+element.instruction+"</option>"}return options};return{meatCuttinInstructions:function(lineId){var list=$("#cutting-lists").data("meatcuttinglist");return cuttingInstructionsElement(lineId,list,"meatCutting")},fishCuttinInstructions:function(lineId){var list=$("#cutting-lists").data("fishcuttinglist");return cuttingInstructionsElement(lineId,list,"fishCutting")}}}(),MasterCartFishShop=function(){"use strict";return{checkPopupVisibility:function(){var masterCartId=parseInt($("#mastercart").attr("data-id"));if(null==masterCartId||!masterCartId)return!1;var url=Routing.generate("mastercart_fish_shop_popup",{id:masterCartId});$.get(url,function(response){response.success&&($("#cart-sidebar").hasClass("hidden")||$("#mastercart").click(),$("#fishShopPopup").fadeIn(),$("#fishShopPopup a").attr("href",response.path),setTimeout(function(){$("#fishShopPopup").fadeOut()},1e4))})}}}(),function(){if("true"!==Cookies.get("fontLoaded")){var fontThin=new FontFaceObserver("Source Sans Pro",{weight:300}),fontRegular=new FontFaceObserver("Source Sans Pro",{weight:400}),fontBold=new FontFaceObserver("Source Sans Pro",{weight:600});Promise.all([fontThin.load(),fontRegular.load(),fontBold.load()]).then(function(){document.documentElement.classList.add("fonts-loaded"),Cookiebot.consent.preferences&&Cookies.set("fontLoaded",!0,{path:"/"})})}}(),MasterCartMeatShop=function(){"use strict";return $("#meatShopPopup .close").on("click",function(){$("#meatShopPopup").fadeOut()}),{checkPopupVisibility:function(){var masterCartId=parseInt($("#mastercart").attr("data-id"));if(null==masterCartId||!masterCartId)return!1;var url=Routing.generate("mastercart_meat_shop_popup",{id:masterCartId});$.get(url,function(response){response.success&&($("#cart-sidebar").hasClass("hidden")||$("#mastercart").click(),$("#meatShopPopup").fadeIn(),$("#meatShopPopup .store-link").attr("href",response.path),setTimeout(function(){$("#meatShopPopup").fadeOut()},15e3))})}}}(),$(document).ready(function(){var openTrigger,$viewportM=764;$(".cd-dropdown-trigger").on("click",function(event){event.preventDefault(),$(window).width()>=$viewportM&&$(".db-overlay").addClass("is-visible"),toggleNav($(this).parent())}),$(".cd-dropdown .cd-close").on("click",function(event){event.preventDefault(),toggleNav($(this).parent())}),1024<$(window).width()&&$(".js-category").on("mouseover",function(){var $windowHeight=$(window).height(),topHeaderHeight=$(".js-top-header").height(),$subMenuTop=$(this).offset().top-$(window).scrollTop();"undefined"!==!topHeaderHeight&&$(window).scrollTop()<topHeaderHeight&&($subMenuTop-=topHeaderHeight);var $subMenu=$(this).children("ul"),$subMenuHeight=$subMenu.height();$windowHeight<$subMenuTop+$subMenuHeight?$subMenu.css({top:"auto",bottom:"0",left:"260px"}):$subMenu.css({top:$subMenuTop-170,bottom:"auto",left:"260px"})}),$(window).width()>=$viewportM&&$(document).mouseup(function(e){var $menuDropdown=$(".js-db-dropdown");$(".cd-dropdown").hasClass("dropdown-is-active")&&($menuDropdown.is(e.target)||0!==$menuDropdown.has(e.target).length||toggleNav(openTrigger))}),$(".has-children").children("a").on("click",function(event){(isMobile.any()||$(window).width()<=1024)&&(event.preventDefault(),$(".cd-dropdown-content").scrollTop(0)),$(this).next("ul").removeClass("is-hidden").end().parent(".has-children").parent("ul").addClass("move-out")});var submenuDirection=$(".cd-dropdown-wrapper").hasClass("open-to-left")?"left":"right";function toggleNav(trigger){var navIsVisible=!trigger.find(".cd-dropdown").hasClass("dropdown-is-active");trigger.find(".cd-dropdown").toggleClass("dropdown-is-active",navIsVisible),trigger.find(".cd-dropdown-trigger").toggleClass("dropdown-is-active",navIsVisible),openTrigger=navIsVisible?(openTrigger&&openTrigger[0]!==trigger[0]&&toggleNav(openTrigger),trigger):($(window).width()>=$viewportM&&$(".db-overlay").removeClass("is-visible"),trigger.find(".cd-dropdown").one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){trigger.find(".has-children ul").addClass("is-hidden"),trigger.find(".move-out").removeClass("move-out"),trigger.find(".is-active").removeClass("is-active")}),null)}$(".cd-dropdown-content").menuAim({activate:function(row){$(row).children().addClass("is-active").removeClass("fade-out"),0===$(".cd-dropdown-content .fade-in").length&&$(row).children("ul").addClass("fade-in")},deactivate:function(row){$(row).children().removeClass("is-active"),(0===$("li.has-children:hover").length||$("li.has-children:hover").is($(row)))&&($(".cd-dropdown-content").find(".fade-in").removeClass("fade-in"),$(row).children("ul").addClass("fade-out"))},exitMenu:function(){return $(".cd-dropdown-content").find(".is-active").removeClass("is-active"),!0},submenuDirection:submenuDirection}),$(".go-back").on("click",function(){$(this).parent("ul").addClass("is-hidden").parent(".has-children").parent("ul").removeClass("move-out")})}),NewsletterReminder=function(){"use strict";var canCustomerApply=function(){$.ajax({type:"POST",url:newsletterReminderCanCustomerApplyUrl,success:function(response){void 0!==response.canApply&&response.canApply&&reminderPopup.modal("show")}})},reminderPopup=bootbox.confirm({message:"¿Quieres recibir Ofertas y Descuentos que te ayuden a ahorrar en tus compras?",show:!1,buttons:{confirm:{label:"SI 😎"},cancel:{label:"No 😥"}},backdrop:!1,callback:function(result){result&&$.ajax({type:"POST",url:newsletterReminderSubscriptionApplyUrl,success:function(response){void 0!==response.success&&response.success&&(gratitudePopup.modal("show"),$(".discount-popup").hide())}})}}),gratitudePopup=bootbox.alert({ok:{label:"Continuar comprando"},show:!1,backdrop:!1,message:"¡Gracias! <br/> A partir de ahora te informaremos de todo ello a través de email y nuestra app"});return{initialize:function(){canCustomerApply()},showModal:function(){reminderPopup.modal("show")}}}(),$(document).ready(function(){var checkbox=$("#newsletter-suscription-menu");checkbox.click(function(){checkbox.prop("checked")?$.ajax({type:"POST",url:newsletterReminderSubscriptionApplyUrl,success:function(response){void 0!==response.success&&response.success&&checkbox.prop("checked",!0)}}):$.ajax({type:"POST",url:newsletterUnSubscribeUrl,success:function(response){void 0!==response.success&&response.success&&checkbox.prop("checked",!1)}})});var radio=$("#newsletter-suscription-payment");radio.click(function(){radio.prop("checked")&&$.ajax({type:"POST",url:newsletterReminderSubscriptionApplyUrl})})}),$(function(){webshims.cfg.no$Switch=!0,webshim.setOptions("forms",{lazyCustomMessages:!0,iVal:{sel:".ws-validate",handleBubble:"hide",errorMessageClass:"help-block",successWrapperClass:"has-success",errorWrapperClass:"has-error",fieldWrapper:".form-group",fx:"fade"}}),webshim.setOptions("loadStyles",!1),webshim.polyfill("forms")}),$(document).ready(function(){var i,coll=document.getElementsByClassName("collapsible");for(i=0;i<coll.length;i++)coll[i].addEventListener("click",function(){this.classList.toggle("active");var content=this.parentElement.nextElementSibling;"block"===content.style.display?content.style.display="none":content.style.display="block"})}),$(document).ready(function(){resetFilter();var selectorId="#fixed-store-list";$(".cat-title",selectorId+" .main-cat-navigation").click({id:selectorId},selectCategory),$(selectorId+" .reset-icon").click({id:selectorId},resetFilter),$("li",selectorId+" .dropdown-cat-navigation").click({id:selectorId},selectFromDropdown),$("#storeList").on("click",function(){$('#fixed-store-list [data-drop-category="todas"]').addClass("selected-category"),$(".categories-filter-layout").fadeIn(),$(".selector-layout").fadeOut(),$(".header.header-inner").removeClass("ten-minute-window"),$(window).scrollTop(0)}),$("#user-submenu-button").on("click",function(){var userMenu=$(".user-submenu");userMenu.is(":visible")||userMenu.slideToggle()}),$("#open-postal-code-window, .js-close-zip").on("click",function(){var postalCodeMenu=$(".change-postal-code-window");postalCodeMenu.is(":visible")||postalCodeMenu.slideToggle()}),$(document).on("mouseup",function(event){$userMenu=$(".user-submenu"),$postalCodeMenu=$(".change-postal-code-window"),!$userMenu.is(event.target)&&0===$userMenu.has(event.target).length&&$userMenu.is(":visible")&&$userMenu.slideToggle(),!$postalCodeMenu.is(event.target)&&0===$postalCodeMenu.has(event.target).length&&$postalCodeMenu.is(":visible")&&$postalCodeMenu.slideToggle()}),$(".display-after-load").css("visibility","visible")}),ValidateSpanishID=function(){"use strict";var DNI_REGEX=/^(\d{8})([A-Z])$/,CIF_REGEX=/^([ABCDEFGHJKLMNPQRSUVW])(\d{7})([0-9A-J])$/,NIE_REGEX=/^[XYZ]\d{7,8}[A-Z]$/,spainIdType=function(str){return str.match(DNI_REGEX)?"dni":str.match(CIF_REGEX)?"cif":str.match(NIE_REGEX)?"nie":void 0},validDNI=function(dni){return"TRWAGMYFPDXBNJZSQVHLCKE".charAt(parseInt(dni,10)%23)==dni.charAt(8)},validNIE=function(nie){var nie_prefix=nie.charAt(0);switch(nie_prefix){case"X":nie_prefix=0;break;case"Y":nie_prefix=1;break;case"Z":nie_prefix=2}return validDNI(nie_prefix+nie.substr(1))},validCIF=function(cif){for(var n,match=cif.match(CIF_REGEX),letter=match[1],number=match[2],control=match[3],even_sum=0,odd_sum=0,i=0;i<number.length;i++)n=parseInt(number[i],10),i%2==0?odd_sum+=(n*=2)<10?n:n-9:even_sum+=n;var control_digit=10-(even_sum+odd_sum).toString().substr(-1),control_letter="JABCDEFGHI".substr(control_digit,1);return letter.match(/[ABEH]/)?control==control_digit:letter.match(/[KPQS]/)?control==control_letter:control==control_digit||control==control_letter};return function(str){str=str.toUpperCase().replace(/\s/,"");var valid=!1,type=spainIdType(str);switch(type){case"dni":valid=validDNI(str);break;case"nie":valid=validNIE(str);break;case"cif":valid=validCIF(str)}return{type:type,valid:valid}}}(),$(".cif-nif-validate").keyup(function(event){var input=$(this),formGroup=input.closest(".form-group"),validation=ValidateSpanishID(input.val());formGroup.removeClass("has-success"),formGroup.removeClass("has-error"),$("#cif-nif-error-message").remove(),validation.valid?(formGroup.removeClass("has-error"),formGroup.addClass("has-success"),$("#cif-nif-error-message").remove()):(formGroup.removeClass("has-success"),formGroup.addClass("has-error"),formGroup.append('<div class="ws-errorbox" style="" id="cif-nif-error-message"><p class="help-block">El CIF/NIF no corresponde a un formato válido.</p></div>'))});